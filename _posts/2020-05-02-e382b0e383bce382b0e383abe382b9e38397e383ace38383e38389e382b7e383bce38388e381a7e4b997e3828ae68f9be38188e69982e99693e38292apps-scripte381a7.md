---
id: 351
title: 'グーグルスプレッドシートで乗り換え時間をApps Scriptで調べる'
date: '2020-05-02T15:13:21+00:00'
author: 'Kenichi Kurihara'
layout: post
guid: 'https://www.kenichikurihara.com/?p=351'
permalink: /2020/05/02/%e3%82%b0%e3%83%bc%e3%82%b0%e3%83%ab%e3%82%b9%e3%83%97%e3%83%ac%e3%83%83%e3%83%89%e3%82%b7%e3%83%bc%e3%83%88%e3%81%a7%e4%b9%97%e3%82%8a%e6%8f%9b%e3%81%88%e6%99%82%e9%96%93%e3%82%92apps-script%e3%81%a7/
categories:
    - Uncategorized
---

乗り換え時間をたくさん調べたかったのでGoogle Apps Scriptを書きました。スプレッドシートのメニューのツール→スクリプト エディタから以下のスクリプトを入力

```
function getDirectionTimeInSec(origin, destination) {
  var now = new Date();
  var finder = Maps.newDirectionFinder()
    .setOrigin(origin)
    .setDestination(destination)
    .setDepart(now)
    .setMode(Maps.DirectionFinder.Mode.TRANSIT);
  var directions = finder.getDirections();
  if (directions.routes.length == 0) {
    throw "no route";
  }
  var route = directions.routes[0];
  if (route.legs.length == 0) {
    throw "no leg";
  }
  var time = route.legs[0].duration.value;
  Logger.log("time = " + time);
  return time;
}

function getDirectionTimeInMin(origin, destination) {
  return Math.ceil(getDirectionTimeInSec(origin, destination) / 60);
}

function debugGetDirectionTime() {
  return getDirectionTimeInMin("Shibuya", "Shinjuku");
}
```

スプレッドシートからは以下のように使います

<figure><img src="/wp-content/uploads/2020/05/spreadsheet-transit.png" alt="" /></figure>